Setting up environment...
Starting evaluation run...
/scratch/p8190783-hma153/pathfinding-transformer/planner.py:32: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  self.model.load_state_dict(torch.load(model_path, map_location=device))
Using device: cuda
Target Grid Size: 100x100
Patch Size: 11x11
Model Sequence Length: 123
Coordinate Vocab Size: 100

--- Running Evaluation ---
Args: Namespace(results_dir='evaluation_results/game_maps_latest', model_path='trained_models/model_best.pth', max_steps=10000, model_patch_size=11, model_coord_size=100, use_random_grids=False, use_maze_grids=False, use_game_grids=True, num_cases=500, eval_grid_size=100, obstacle_density=0.3, game_grids_dir='~/Datasets/a_star_maps/', num_scenarios_per_map=2, eval_mode='game', use_maze_generation=False)
Initializing planner with patch size 11 and target grid 100x100
Transformer model loaded successfully from trained_models/model_best.pth
Loading game grids from: ~/Datasets/a_star_maps/
Found 156 .map files.
Prepared 312 scenarios from game maps.
Evaluating Environments:   0%|          | 0/312 [00:00<?, ?it/s]Evaluating: oth000d.map_scen1:   0%|          | 0/312 [00:00<?, ?it/s]Evaluating: oth000d.map_scen1:   0%|          | 1/312 [00:01<05:28,  1.06s/it]Evaluating: oth000d.map_scen2:   0%|          | 1/312 [00:01<05:28,  1.06s/it]Evaluating: oth000d.map_scen2:   1%|          | 2/312 [00:01<02:51,  1.80it/s]Evaluating: orz101d.map_scen1:   1%|          | 2/312 [00:01<02:51,  1.80it/s]Evaluating: orz101d.map_scen1:   1%|          | 3/312 [00:01<02:06,  2.45it/s]Evaluating: orz101d.map_scen2:   1%|          | 3/312 [00:01<02:06,  2.45it/s]Evaluating: lak107d.map_scen1:   1%|          | 3/312 [00:01<02:06,  2.45it/s]Evaluating: lak107d.map_scen2:   1%|          | 3/312 [00:01<02:06,  2.45it/s]Evaluating: lak107d.map_scen2:   2%|▏         | 6/312 [00:01<00:49,  6.24it/s]Evaluating: den500d.map_scen1:   2%|▏         | 6/312 [00:01<00:49,  6.24it/s]Evaluating: den500d.map_scen2:   2%|▏         | 6/312 [00:02<00:49,  6.24it/s]Evaluating: den500d.map_scen2:   3%|▎         | 8/312 [00:05<04:23,  1.15it/s]Evaluating: brc101d.map_scen1:   3%|▎         | 8/312 [00:05<04:23,  1.15it/s]Evaluating: brc101d.map_scen1:   3%|▎         | 9/312 [00:06<04:09,  1.22it/s]Evaluating: brc101d.map_scen2:   3%|▎         | 9/312 [00:06<04:09,  1.22it/s]Evaluating: brc101d.map_scen2:   3%|▎         | 10/312 [00:06<03:46,  1.34it/s]Evaluating: hrt201d.map_scen1:   3%|▎         | 10/312 [00:06<03:46,  1.34it/s]Evaluating: hrt201d.map_scen1:   4%|▎         | 11/312 [00:06<03:03,  1.64it/s]Evaluating: hrt201d.map_scen2:   4%|▎         | 11/312 [00:06<03:03,  1.64it/s]Evaluating: hrt201d.map_scen2:   4%|▍         | 12/312 [00:08<03:40,  1.36it/s]Evaluating: den207d.map_scen1:   4%|▍         | 12/312 [00:08<03:40,  1.36it/s]Evaluating: den207d.map_scen1:   4%|▍         | 13/312 [00:08<02:52,  1.74it/s]Evaluating: den207d.map_scen2:   4%|▍         | 13/312 [00:08<02:52,  1.74it/s]Evaluating: den207d.map_scen2:   4%|▍         | 14/312 [00:08<02:20,  2.12it/s]Evaluating: orz700d.map_scen1:   4%|▍         | 14/312 [00:08<02:20,  2.12it/s]Evaluating: orz700d.map_scen1:   5%|▍         | 15/312 [00:09<03:47,  1.31it/s]Evaluating: orz700d.map_scen2:   5%|▍         | 15/312 [00:09<03:47,  1.31it/s]Evaluating: orz700d.map_scen2:   5%|▌         | 16/312 [00:10<04:03,  1.21it/s]Evaluating: lgt101d.map_scen1:   5%|▌         | 16/312 [00:10<04:03,  1.21it/s]Evaluating: lgt101d.map_scen2:   5%|▌         | 16/312 [00:10<04:03,  1.21it/s]Evaluating: lak103d.map_scen1:   5%|▌         | 16/312 [00:10<04:03,  1.21it/s]Evaluating: lak103d.map_scen1:   6%|▌         | 19/312 [00:11<01:57,  2.50it/s]Evaluating: lak103d.map_scen2:   6%|▌         | 19/312 [00:11<01:57,  2.50it/s]Evaluating: lak103d.map_scen2:   6%|▋         | 20/312 [00:11<01:40,  2.90it/s]Evaluating: orz105d.map_scen1:   6%|▋         | 20/312 [00:11<01:40,  2.90it/s]Evaluating: orz105d.map_scen1:   7%|▋         | 21/312 [00:11<01:24,  3.45it/s]Evaluating: orz105d.map_scen2:   7%|▋         | 21/312 [00:11<01:24,  3.45it/s]Evaluating: orz105d.map_scen2:   7%|▋         | 22/312 [00:11<01:11,  4.05it/s]Evaluating: orz999d.map_scen1:   7%|▋         | 22/312 [00:11<01:11,  4.05it/s]Evaluating: orz999d.map_scen1:   7%|▋         | 23/312 [00:12<02:51,  1.69it/s]Evaluating: orz999d.map_scen2:   7%|▋         | 23/312 [00:12<02:51,  1.69it/s]Evaluating: orz999d.map_scen2:   8%|▊         | 24/312 [00:16<06:17,  1.31s/it]Evaluating: den203d.map_scen1:   8%|▊         | 24/312 [00:16<06:17,  1.31s/it]Evaluating: den203d.map_scen2:   8%|▊         | 24/312 [00:16<06:17,  1.31s/it]Evaluating: den203d.map_scen2:   8%|▊         | 26/312 [00:16<03:38,  1.31it/s]Evaluating: brc999d.map_scen1:   8%|▊         | 26/312 [00:16<03:38,  1.31it/s]Evaluating: brc999d.map_scen1:   9%|▊         | 27/312 [00:17<03:40,  1.29it/s]Evaluating: brc999d.map_scen2:   9%|▊         | 27/312 [00:17<03:40,  1.29it/s]Evaluating: brc999d.map_scen2:   9%|▉         | 28/312 [00:17<03:03,  1.55it/s]Evaluating: orz704d.map_scen1:   9%|▉         | 28/312 [00:17<03:03,  1.55it/s]Evaluating: orz704d.map_scen2:   9%|▉         | 28/312 [00:17<03:03,  1.55it/s]Evaluating: den504d.map_scen1:   9%|▉         | 28/312 [00:17<03:03,  1.55it/s]Evaluating: den504d.map_scen1:  10%|▉         | 31/312 [00:19<03:07,  1.50it/s]Evaluating: den504d.map_scen2:  10%|▉         | 31/312 [00:19<03:07,  1.50it/s]Evaluating: den504d.map_scen2:  10%|█         | 32/312 [00:19<02:44,  1.70it/s]Evaluating: lgt602d.map_scen1:  10%|█         | 32/312 [00:19<02:44,  1.70it/s]Evaluating: lgt602d.map_scen1:  11%|█         | 33/312 [00:20<02:40,  1.74it/s]Evaluating: lgt602d.map_scen2:  11%|█         | 33/312 [00:20<02:40,  1.74it/s]Evaluating: lgt602d.map_scen2:  11%|█         | 34/312 [00:22<04:26,  1.04it/s]Evaluating: lak512d.map_scen1:  11%|█         | 34/312 [00:22<04:26,  1.04it/s]Evaluating: lak512d.map_scen1:  11%|█         | 35/312 [00:23<04:21,  1.06it/s]Evaluating: lak512d.map_scen2:  11%|█         | 35/312 [00:23<04:21,  1.06it/s]Evaluating: lak512d.map_scen2:  12%|█▏        | 36/312 [00:23<03:51,  1.19it/s]Evaluating: orz301d.map_scen1:  12%|█▏        | 36/312 [00:23<03:51,  1.19it/s]Evaluating: orz301d.map_scen1:  12%|█▏        | 37/312 [00:24<03:12,  1.43it/s]Evaluating: orz301d.map_scen2:  12%|█▏        | 37/312 [00:24<03:12,  1.43it/s]Evaluating: orz301d.map_scen2:  12%|█▏        | 38/312 [00:24<02:29,  1.83it/s]Evaluating: lak307d.map_scen1:  12%|█▏        | 38/312 [00:24<02:29,  1.83it/s]Evaluating: lak307d.map_scen2:  12%|█▏        | 38/312 [00:24<02:29,  1.83it/s]Evaluating: lak307d.map_scen2:  13%|█▎        | 40/312 [00:24<01:29,  3.06it/s]Evaluating: orz800d.map_scen1:  13%|█▎        | 40/312 [00:24<01:29,  3.06it/s]Evaluating: orz800d.map_scen1:  13%|█▎        | 41/312 [00:27<04:08,  1.09it/s]Evaluating: orz800d.map_scen2:  13%|█▎        | 41/312 [00:27<04:08,  1.09it/s]Evaluating: orz800d.map_scen2:  13%|█▎        | 42/312 [00:31<08:19,  1.85s/it]Evaluating: lak400d.map_scen1:  13%|█▎        | 42/312 [00:31<08:19,  1.85s/it]Evaluating: lak400d.map_scen1:  14%|█▍        | 43/312 [00:32<06:29,  1.45s/it]Evaluating: lak400d.map_scen2:  14%|█▍        | 43/312 [00:32<06:29,  1.45s/it]Evaluating: lak400d.map_scen2:  14%|█▍        | 44/312 [00:38<12:30,  2.80s/it]Evaluating: den101d.map_scen1:  14%|█▍        | 44/312 [00:38<12:30,  2.80s/it]Evaluating: den101d.map_scen2:  14%|█▍        | 44/312 [00:38<12:30,  2.80s/it]Evaluating: lak506d.map_scen1:  14%|█▍        | 44/312 [00:38<12:30,  2.80s/it]Evaluating: lak506d.map_scen1:  15%|█▌        | 47/312 [00:38<06:03,  1.37s/it]Evaluating: lak506d.map_scen2:  15%|█▌        | 47/312 [00:38<06:03,  1.37s/it]Evaluating: lak506d.map_scen2:  15%|█▌        | 48/312 [00:39<05:22,  1.22s/it]Evaluating: orz500d.map_scen1:  15%|█▌        | 48/312 [00:39<05:22,  1.22s/it]Evaluating: orz500d.map_scen1:  16%|█▌        | 49/312 [00:40<04:54,  1.12s/it]Evaluating: orz500d.map_scen2:  16%|█▌        | 49/312 [00:40<04:54,  1.12s/it]Evaluating: orz500d.map_scen2:  16%|█▌        | 50/312 [00:40<04:12,  1.04it/s]Evaluating: den510d.map_scen1:  16%|█▌        | 50/312 [00:40<04:12,  1.04it/s]Evaluating: den510d.map_scen1:  16%|█▌        | 50/312 [00:41<03:37,  1.20it/s]
Warning: Invalid start (np.int64(17), np.int64(26)) or goal (np.int64(10), np.int64(5)) for grid size 26.
Warning: Invalid start (np.int64(7), np.int64(38)) or goal (np.int64(4), np.int64(27)) for grid size 28.
Warning: Invalid start (np.int64(15), np.int64(80)) or goal (np.int64(62), np.int64(54)) for grid size 77.
Warning: Invalid start (np.int64(11), np.int64(63)) or goal (np.int64(27), np.int64(12)) for grid size 46.
Warning: Invalid start (np.int64(42), np.int64(49)) or goal (np.int64(39), np.int64(52)) for grid size 46.
Warning: Invalid start (np.int64(27), np.int64(49)) or goal (np.int64(14), np.int64(26)) for grid size 41.
Traceback (most recent call last):
  File "/scratch/p8190783-hma153/pathfinding-transformer/evaluate.py", line 385, in <module>
    run_evaluation(eval_args)
  File "/scratch/p8190783-hma153/pathfinding-transformer/evaluate.py", line 202, in run_evaluation
    astar_path, astar_nodes = a_star_search(test_env, start_node, goal_node)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/p8190783-hma153/pathfinding-transformer/astar.py", line 46, in a_star_search
    for neighbor_node, cost_to_reach, _ in grid_env.get_neighbors(current_node[0], current_node[1]):
                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/p8190783-hma153/pathfinding-transformer/environment.py", line 100, in get_neighbors
    if self.is_valid(nr, nc) and not self.is_obstacle(nr, nc):
                                     ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/p8190783-hma153/pathfinding-transformer/environment.py", line 113, in is_obstacle
    return self.grid[r, c] == 1
           ~~~~~~~~~^^^^^^
IndexError: index 385 is out of bounds for axis 1 with size 385
Evaluation script finished.
